<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>PRM ONLINE ULTRA</title>
<style>
  body {
    margin: 0; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif; background: #0f0f0f; color: white;
  }
  header {
    background: #8b0000; padding: 15px; text-align: center; font-size: 20px;
  }
  .clock {
    font-size: 13px;
  }
  .container {
    padding: 15px;
  }
  .card {
    background: #1c1c1c; padding: 15px; margin-bottom: 15px; border-radius: 8px;
  }
  input, select {
    width: 100%; padding: 8px; margin: 5px 0; border: none; border-radius: 5px;
  }
  button {
    padding: 8px; border: none; border-radius: 5px; background: #b30000; color: white; cursor: pointer;
  }
  button:hover {
    background: red;
  }
  .badge {
    padding: 4px 6px; border-radius: 4px; font-size: 12px;
  }
  .online {
    background: green;
  }
  .offline {
    background: gray;
  }
  .status {
    background: orange;
  }
  .hidden {
    display: none;
  }
</style>
</head>
<body>

<header>
  ðŸš‘ PRM ONLINE TABLET<br />
  <div class="clock" id="clock"></div>
</header>

<div class="container">

  <div id="loginPanel" class="card">
    <h3>Logowanie</h3>
    <input type="text" id="name" placeholder="ImiÄ™ i Nazwisko" />
    <input type="text" id="team" placeholder="Numer ZespoÅ‚u (np. P01)" />
    <button id="loginBtn">WejdÅº do systemu</button>
  </div>

  <div id="mainPanel" class="hidden">

    <div class="card">
      <button id="fullscreenBtn">ðŸ“± Tryb Tablet (Fullscreen)</button>
    </div>

    <div class="card">
      <h3>Aktywni pracownicy</h3>
      <div id="workers"></div>
    </div>

    <div class="card">
      <h3>Dodaj wezwanie</h3>
      <input type="text" id="location" placeholder="Lokalizacja" />
      <button id="addCallBtn">Dodaj</button>
    </div>

    <div class="card">
      <h3>Wezwania LIVE</h3>
      <div id="calls"></div>
    </div>

  </div>
</div>

<script type="module">
// --- Firebase configuration ---
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-app.js";
import { getDatabase, ref, push, set, onValue, onDisconnect } from "https://www.gstatic.com/firebasejs/10.12.0/firebase-database.js";

// Twoja konfiguracja Firebase:
const firebaseConfig = {
  apiKey: "AIzaSyAP8Ta-m97rmFVc1WlJGAn3X7qYZgnxGuQ",
  authDomain: "prm-tablet.firebaseapp.com",
  projectId: "prm-tablet",
  storageBucket: "prm-tablet.firebasestorage.app",
  messagingSenderId: "136531217355",
  appId: "1:136531217355:web:6a6bfade5c34e4d0f1044e",
  measurementId: "G-CE9PL2NZ21"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// --- Zegar ---
function clock() {
  document.getElementById("clock").textContent =
    new Date().toLocaleString("pl-PL", { timeZone: "Europe/Warsaw" });
}
setInterval(clock, 1000);
clock();

// --- Zmienne ---
let userId = null;

// --- Logowanie ---
document.getElementById("loginBtn").addEventListener("click", () => {
  const name = document.getElementById("name").value.trim();
  const team = document.getElementById("team").value.trim();

  if (!name || !team) {
    alert("UzupeÅ‚nij dane!");
    return;
  }

  userId = Date.now().toString();

  const userRef = ref(db, "workers/" + userId);
  set(userRef, {
    name: name,
    team: team,
    status: "ONLINE"
  });

  onDisconnect(userRef).update({ status: "OFFLINE" });

  document.getElementById("loginPanel").classList.add("hidden");
  document.getElementById("mainPanel").classList.remove("hidden");
});

// --- Lista aktywnych pracownikÃ³w ---
const workersDiv = document.getElementById("workers");
onValue(ref(db, "workers"), (snapshot) => {
  const data = snapshot.val();
  let html = "";
  if (data) {
    for (let id in data) {
      const w = data[id];
      html += `<div class="card">${w.name} | ZespÃ³Å‚: ${w.team} <span class="badge ${w.status === "ONLINE" ? "online" : "offline"}">${w.status}</span></div>`;
    }
  } else {
    html = "<i>Brak aktywnych pracownikÃ³w</i>";
  }
  workersDiv.innerHTML = html;
});

// --- Dodawanie wezwania ---
document.getElementById("addCallBtn").addEventListener("click", () => {
  const loc = document.getElementById("location").value.trim();
  if (!loc) {
    alert("Podaj lokalizacjÄ™!");
    return;
  }

  push(ref(db, "calls"), {
    location: loc,
    time: new Date().toLocaleString("pl-PL", { timeZone: "Europe/Warsaw" }),
    status: "OCZEKUJE"
  });

  document.getElementById("location").value = "";
});

// --- WyÅ›wietlanie wezwaÅ„ ---
const callsDiv = document.getElementById("calls");
onValue(ref(db, "calls"), (snapshot) => {
  const data = snapshot.val();
  let html = "";
  if (data) {
    for (let id in data) {
      const c = data[id];
      html += `<div class="card">Lokalizacja: ${c.location}<br>Czas: ${c.time}<br>Status: <span class="badge status">${c.status}</span></div>`;
    }
  } else {
    html = "<i>Brak wezwaÅ„</i>";
  }
  callsDiv.innerHTML = html;
});

// --- Fullscreen ---
document.getElementById("fullscreenBtn").addEventListener("click", () => {
  if (document.documentElement.requestFullscreen) {
    document.documentElement.requestFullscreen();
  }
});
</script>

</body>
</html>
